set folder = "imaps://simu@sspaeti.com@imap.mail.hostpoint.ch:993"
set smtp_url = "smtp://simu@sspaeti.com@asmtp.mail.hostpoint.ch:587"


# set smpt password with ENV variable
# set smtp_pass = "$HOSTSPINT_SMTP_PASSWORD_SIMU"
# set imap_pass = "password"
source ~/.dotfiles/zsh/.secret.muttrc

set from = "simu@sspaeti.com"
set realname = "Simon Sp√§ti"

set spoolfile = "+Inbox"
set record = "+Sent"
set trash = "+Trash"
set postponed = "+Drafts"

# Ensure TLS is enforced
set ssl_starttls = yes
set ssl_force_tls = yes

mailboxes =Inbox =ToScreen =ScreenedOut =Waiting =Scheduled =Someday =Sent =Trash =Drafts =Junk =Archive =Others



# SCREENER
#
## Step 3: Decision Making Macros
# macro index,pager I "<shell-escape>echo %:from-email >> ~/.config/mutt/screened_in.txt<enter><save-message>=Inbox<enter>" "Screen in this sender"
macro index,pager I "<pipe-message>awk '/^From: / {print \$NF}' | tr -d '<>' | xargs -I {} echo {} >> ~/.config/mutt/screened_in.txt<enter><save-message>=Inbox<enter>" "Screen in this sender"

# macro index,pager O "<shell-escape>echo %:from-email >> ~/.config/mutt/screened_out.txt<enter><save-message>=ScreenedOut<enter>" "Screen out this sender"
macro index,pager O "<pipe-message>awk '/^From: / {print \$NF}' | tr -d '<>' | xargs -I {} echo {} >> ~/.config/mutt/screened_out.txt<enter><save-message>=ScreenedOut<enter>" "Screen out this sender"


## Step 4: Filtering Views in Mutt
macro index,pager L "<shell-escape>~/.config/mutt/generate_pattern.sh<enter>" "Exclude emails from screen_out.txt"
macro index,pager A "<shell-escape>~/.config/mutt/generate_pattern_in.sh<enter>" "Select accepted emails from screen_in.txt"

## Step 6: Updating Lists and Filters
set my_screen_update_macro="<shell-escape>~/.config/mutt/update_screen_lists.sh<enter>"
# macro index F5 "<shell-escape>~/.config/mutt/update_screen_lists.sh<enter>"





#
# handling screening of senders (hide not important senders out of my inbox)
# --> ignored emails are in .secret.muttrc above, but these are not moved to folder, just ignored in inbox

# Define a pattern for filtering emails from the specified sender
# pattern index,sent,browser "from:"jack@jacksflightclub\.com "ScreenedOut"


# # Define a macro to mark matching emails for deletion
# macro index,pager X "|~b %s^$sender@example\.com\n" "Mark emails from sender@example.com for deletion"

# # Redirect marked emails to the "Blocked" folder (change the folder name if needed)
# folder-hook . 'push -f +ScreenedOut ~b $sender@example\.com'



# macro index O "<save-message>+ScreenedOut<enter>" "Screen out this email"

# macro index,pager O "<save-message>=ScreenedOut<enter><next-undeleted>" "Screen out based on list"
# macro index,pager A "<save-message>=Inbox<enter><next-undeleted>" "Accept based on list"
# macro index,pager L ":limit ~f `cat ~/.config/mutt/screened_out.txt | tr '\n' '|'`<enter>" "Limit view to screen-out list"
# macro index,pager U ":unlimit<enter>" "Remove limit"
# :set limit="~f `cat ~/.config/mutt/screened_out.txt | tr '\n' '|' | sed 's/|$//'`"
# macro index L ":exec pattern ~f `cat ~/.config/mutt/screened_out.txt | tr '\n' '|' | sed 's/|$//'`<enter>" "Limit view to screen-out list"
# macro index U ":exec pattern .<enter>" "Remove limit"

# macro index,pager L "T!~f bla@bla\.com !~f no-reply@dsb-email\.dk<enter>" "Exclude emails from two addresses"

# worked best
# macro index,pager L "T`~/.config/mutt/generate_pattern.sh`<enter>" "Exclude emails from screened_out.txt"
# macro index,pager O "T`~/.config/mutt/generate_pattern_in.sh`<enter>" "Select accepted emails from screened_in.txt"



# Where to put the stuff
set header_cache = "~/.cache/mutt/headers"
set message_cachedir = "~/.cache/mutt/bodies"
set certificate_file = "~/.cache/mutt/certificates"
#unset record

set signature = "~/.config/mutt/signature"

# link to mailcap file
set mailcap_path = "~/.config/mutt/mailcap"
# open attachments with mailcap with <return>
bind attach <return> view-mailcap             
# save attachments to a folder
macro attach s '<save-entry> <bol>~/Documents/attachments/<eol>' 'save attachment'
auto_view text/html		# automatically show html (mailcap uses lynx)

#urlscan: open urls
macro index,pager \cb "<pipe-message> urlscan<Enter>" "call urlscan to extract URLs out of a message"
macro attach,compose \cb "<pipe-entry> urlscan<Enter>" "call urlscan to extract URLs out of a message"

# query
set query_command="/opt/homebrew/bin/lbdbq '%s'"
bind editor <Tab> complete-query

source ~/.config/mutt/color.muttrc

bind index,pager i noop
bind index,pager g noop
bind index \Cf noop
bind index,pager M noop
bind index,pager C noop

# General rebindings
set editor = "nvim"
bind index gg first-entry
bind index j next-entry
bind index k previous-entry
bind attach <return> view-mailcap
bind attach l view-mailcap
bind editor <space> noop
bind index G last-entry
bind pager,attach h exit
bind pager j next-line
bind pager k previous-line
bind pager l view-attachments
bind index D delete-message
# bind index U undelete-message
# bind index L limit
bind index h noop
bind index l display-message
bind index,query <space> tag-entry
#bind browser h goto-parent
macro browser h '<change-dir><kill-line>..<enter>' "Go to parent folder"
bind index,pager H view-raw-message
bind browser l select-entry
bind browser gg top-page
bind browser G bottom-page
bind pager gg top
bind pager G bottom
# bind attach,index,pager \CD next-page
# bind attach,index,pager \CU previous-page
bind index,pager,browser d half-down
bind index,pager,browser u half-up
bind index,pager S sync-mailbox
bind index,pager R group-reply
bind index \031 previous-undeleted	# Mouse wheel
bind index \005 next-undeleted		# Mouse wheel
bind pager \031 previous-line		# Mouse wheel
bind pager \005 next-line		# Mouse wheel
bind editor <Tab> complete-query




macro index,pager gi "<change-folder>=INBOX<enter>" "go to inbox"
macro index,pager Mi ";<save-message>=INBOX<enter>" "move mail to inbox"
macro index,pager Ci ";<copy-message>=INBOX<enter>" "copy mail to inbox"
macro index,pager gd "<change-folder>=Drafts<enter>" "go to drafts"
macro index,pager Md ";<save-message>=Drafts<enter>" "move mail to drafts"
macro index,pager Cd ";<copy-message>=Drafts<enter>" "copy mail to drafts"
macro index,pager gj "<change-folder>=Junk<enter>" "go to junk"
macro index,pager Mj ";<save-message>=Junk<enter>" "move mail to junk"
macro index,pager Cj ";<copy-message>=Junk<enter>" "copy mail to junk"
macro index,pager gt "<change-folder>=Trash<enter>" "go to trash"
macro index,pager Mt ";<save-message>=Trash<enter>" "move mail to trash"
macro index,pager Ct ";<copy-message>=Trash<enter>" "copy mail to trash"
macro index,pager gs "<change-folder>=Sent<enter>" "go to sent"
macro index,pager Ms ";<save-message>=Sent<enter>" "move mail to sent"
macro index,pager Cs ";<copy-message>=Sent<enter>" "copy mail to sent"
macro index,pager ga "<change-folder>=Archive<enter>" "go to archive"
macro index,pager Ma ";<save-message>=Archive<enter>" "move mail to archive"
macro index,pager Ca ";<copy-message>=Archive<enter>" "copy mail to archive"

macro index,pager gw "<change-folder>=Waiting<enter>" "go to waiting"
macro index,pager Mw ";<save-message>=Waiting<enter>" "move mail to waiting"
macro index,pager Cw ";<copy-message>=Waiting<enter>" "copy mail to waiting"

macro index,pager gk "<change-folder>=ToScreen<enter>" "go to screener"

macro index,pager go "<change-folder>=ScreenedOut<enter>" "go to screened out"
macro index,pager Mo ";<save-message>=ScreenedOut<enter>" "move mail to screened out"

macro index,pager gl "<show-log-messages><enter>" "go to log messages"

# Sidebar mappings
set sidebar_visible = yes
set sidebar_on_right = yes
set sidebar_width = 20
set sidebar_short_path = yes
set sidebar_next_new_wrap = yes
set mail_check_stats
# set sidebar_format = '%D%?F? [%F]?%* %?N?%N/? %?S?%S?'
set sidebar_format = "%B %* [%?N?%N / ?%S]"
bind index,pager \Ck sidebar-prev
bind index,pager \Cj sidebar-next
bind index,pager \Co sidebar-open
bind index,pager \Cp sidebar-prev-new
bind index,pager \Cn sidebar-next-new
bind index,pager B sidebar-toggle-visible


# general settings from seniormars
set pager_index_lines = 10          
set pager_context = 3                # show 3 lines of context
set pager_stop                       # stop at end of message
set menu_scroll                      # scroll menu
set tilde                            # use ~ to pad mutt
set move=no                          # don't move messages when marking as read
set mail_check = 30                  # check for new mail every 30 seconds
set imap_keepalive = 900             # 15 minutes
set sleep_time = 0                   # don't sleep when idle
set wait_key = no		     # mutt won't ask "press key to continue"
set envelope_from                    # which from?
set edit_headers                     # show headers when composing
set fast_reply                       # skip to compose when replying
set askcc                            # ask for CC:
set fcc_attach                       # save attachments with the body
set forward_format = "Fwd: %s"       # format of subject when forwarding
set forward_decode                   # decode when forwarding
set forward_quote                    # include message in forwards
set mime_forward                     # forward attachments as part of body
set attribution = "On %d, %n wrote:" # format of quoting header
set reply_to                         # reply to Reply to: field
set reverse_name                     # reply as whomever it was to
set include                          # include message in replies
set text_flowed=yes                  # correct indentation for plain text
unset sig_dashes                     # no dashes before sig
unset markers

# Sort by newest conversation first.
set charset = "utf-8"
set uncollapse_jump
set sort_re
set sort = reverse-threads
set sort_aux = last-date-received
# How we reply and quote emails.
set reply_regexp = "^(([Rr][Ee]?(\[[0-9]+\])?: *)?(\[[^]]+\] *)?)*"
set quote_regexp = "^( {0,4}[>|:#%]| {0,4}[a-z0-9]+[>|]+)+"
set send_charset = "utf-8:iso-8859-1:us-ascii" # send in utf-8

# more configs at https://raw.githubusercontent.com/LukeSmithxyz/mutt-wizard/1c5085d3f203fbd4eef8813e0915fd6e3c899570/share/mutt-wizard.muttrc
# and: https://seniormars.github.io/posts/neomutt/#motivation
#
