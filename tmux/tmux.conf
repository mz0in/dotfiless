#use zsh as default
set-option -g default-shell /bin/zsh
#set-option -g default-shell /usr/local/bin/zsh
#set colors: 
#this was added of an error I cant remeber
# set -g default-terminal "rxvt-unicode-256color"
#this is what neovim prefers and otherwise throws an erros in healthcheck
set-option -g default-terminal "screen-256color"


# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
# set -g @plugin 'odedlaz/tmux-onedark-theme'
set -g @plugin 'tmux-plugins/tmux-resurrect' # persist tmux sessions after computer restart
set -g @plugin 'tmux-plugins/tmux-continuum' # automatically saves sessions for you every 15 minutes
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'christoomey/vim-tmux-navigator' # for navigating panes and vim/nvim with Ctrl-hjkl

# set tmux theme --> set in kitty instead
# set -g @plugin 'egel/tmux-gruvbox'
# set -g @tmux-gruvbox 'dark' # or 'light'

# Tokyionight settings
# Undercurl - for tmux
set -g default-terminal "${TERM}"
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'  # undercurl support
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'  # underscore colours - needs tmux-3.0


# Preserves what was readable in each pane.
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-vim 'session'
set -g @continuum-restore 'on'

# Change default prefix key
unbind C-b
set-option -g prefix C-t
set-option -g repeat-time 0

set-window-option -g mode-keys vi
# entering vim mode to copy or scroll up with vim motions
bind 'v' copy-mode

bind-key -T copy-mode-vi 'v' send -X begin-selection # start selecting text with "v"
bind-key -T copy-mode-vi 'y' send -X copy-selection # copy text with "y"
unbind -T copy-mode-vi MouseDragEnd1Pane # don't exit copy mode after dragging with mouse
#map another shortcut to clear window as c-l is now taken for navigation: now `ctrl+t and b`
bind b send-keys 'C-l'

# able to refresh tmux config with "Ctrl-t" and then "r":
unbind r
bind r source-file ~/.tmux.conf

# different key bindings for splitting
# unbind %
bind / split-window -h
# unbind '"'
bind - split-window -v

#vim-like pane switching -> not needed anymore as I use now christoomey/vim-tmux-navigator
# bind -r k select-pane -U 
# bind -r j select-pane -D 
# bind -r h select-pane -L 
# bind -r l select-pane -R

# Switching tmux zoom between panes without zooming out
bind -r u select-pane -t .+1 \;  resize-pane -Z

# double keymaps as in vim are not possible-> sticking with <c-hjkl> thenjkl> thenjkl> then
#unbind s
bind s choose-session
# bind-key -n ss select-pane -R
# bind sl select-pane -R
# bind-key sh select-pane -L

# Resizing pane -> doesn't work well with navigating up and down. Using arrow keys instead
bind -r C-k resize-pane -U 5
bind -r C-j resize-pane -D 5
bind -r C-h resize-pane -L 5
bind -r C-l resize-pane -R 5

# Resize the current pane using Alt + direction
#bind -r M-k resize-pane -U 5
#bind -r M-j resize-pane -D 5
#bind -r M-h resize-pane -L 5
#bind -r M-l resize-pane -R 5

# Enable mouse mode (tmux 2.1 and above) such as select window
set -g mouse on

# Maps <Ctrl>-h to select pane on the left. Vim-like navigation - conflicts a lot with other cmd
# bind aj send-keys -r j
# bind ak send-keys -r k
# bind ah send-keys -r h
# bind al send-keys -r l

#bind -n C-j select-pane -D
#bind -n C-k select-pane -U
#bind -n C-h select-pane -L
#bind -n C-l select-pane -R

#shift + control switch windows
#bind-key -n C-S-Left swap-window -t -1
#bind-key -n C-S-Right swap-window -t +1


#try to use same keybinidng for vim and tmux:
#is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
#    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
#
#bind-key -n sh  if-shell  "$is_vim"  "send-keys sh"  "select-pane -L"   
#source status line theme for tmux:
source-file ~/.tmux/themes/tmux-kanagawa-dark.conf

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
